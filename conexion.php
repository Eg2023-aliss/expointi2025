<?php session_start(); ob_start(); ini_set('display_errors', 1); ini_set('display_startup_errors', 1); error_reporting(E_ALL); // ---------- FUNCIÓN DE CONEXIÓN AUTOMÁTICA ---------- function getPDO() { // 🔹 Primero intenta base local, luego Supabase $configs = [ [ 'host' => 'localhost', 'port' => '5432', 'dbname' => 'postgres', 'user' => 'postgres', 'pass' => 'tu_password_local' ], [ 'host' => 'aws-1-us-east-2.pooler.supabase.com', 'port' => '6543', 'dbname' => 'postgres', 'user' => 'postgres.orzsdjjmyouhhxjfnemt', 'pass' => 'Zv2sW23OhBVM5Tkz' ] ]; foreach ($configs as $cfg) { try { $pdo = new PDO( "pgsql:host={$cfg['host']};port={$cfg['port']};dbname={$cfg['dbname']}", $cfg['user'], $cfg['pass'], [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION] ); error_log("✅ Conectado a la base de datos: {$cfg['host']}"); return $pdo; } catch (PDOException $e) { error_log("⚠️ Error al conectar con {$cfg['host']}: " . $e->getMessage()); continue; } } die("❌ No se pudo conectar ni a la base local ni a la nube."); } // ---------- CONSULTA DE EMPLEADOS ---------- $pdo = getPDO(); try { $stmt = $pdo->query("SELECT * FROM empleados ORDER BY nombre_completo"); $rows = $stmt->fetchAll(PDO::FETCH_ASSOC); } catch (PDOException $e) { die("❌ Error al consultar empleados: " . $e->getMessage()); } ?> <!DOCTYPE html> <html lang="es"> <head> <meta charset="utf-8"> <title>Empleados</title> <link rel="icon" href="logo.png"> <style> body { font-family: Arial, sans-serif; background: #f5f6fa; color: #222; margin: 0; padding: 0; } header { background: #004aad; color: white; padding: 20px; text-align: center; } table { border-collapse: collapse; margin: 40px auto; width: 90%; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); } th, td { padding: 12px 15px; border-bottom: 1px solid #ddd; text-align: left; } th { background-color: #004aad; color: white; } tr:hover { background-color: #f1f1f1; } .btn { background: #004aad; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; transition: 0.3s; } .btn:hover { background: #003580; } footer { text-align: center; padding: 20px; color: #555; } </style> </head> <body> <header> <h1>📋 Lista de Empleados</h1> </header> <table> <tr> <th>ID</th> <th>Nombre Completo</th> <th>Área</th> <th>Cargo</th> <th>Acción</th> </tr> <?php foreach ($rows as $e): ?> <tr> <td><?= htmlspecialchars($e['id']) ?></td> <td><?= htmlspecialchars($e['nombre_completo']) ?></td> <td><?= htmlspecialchars($e['area']) ?></td> <td><?= htmlspecialchars($e['cargo']) ?></td> <td> <button class="btn" onclick="downloadCarnet(<?= $e['id'] ?>)">🎫 Carnet</button> </td> </tr> <?php endforeach; ?> </table> <footer> <p>© 2025 ExpoInti - Render & Supabase</p> </footer> <script> function downloadCarnet(id) { window.location.href = `descargar_carnet.php?id=${id}`; } </script> </body> </html>
